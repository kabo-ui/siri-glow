<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Siri Edge Glow</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  background: transparent;
  overflow: hidden;
}
canvas {
  width: 100vw;
  height: 100vh;
  display: block;
}
</style>
</head>
<body>
<canvas id="c"></canvas>
<audio id="siriSound" preload="auto" src="apple-intelligence-sound-effect-apple-ai-siri.mp3"></audio>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const sound = document.getElementById("siriSound");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let t = 0;
let startTime = null;
let started = false;

// Smooth cubic easing
function ease(p) {
  return p * p * p * (p * (6 * p - 15) + 10);
}

function roundedRect(x, y, w, h, r) {
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.arcTo(x + w, y, x + w, y + h, r);
  ctx.arcTo(x + w, y + h, x, y + h, r);
  ctx.arcTo(x, y + h, x, y, r);
  ctx.arcTo(x, y, x + w, y, r);
  ctx.closePath();
}

// Clip area for liquid expansion
function liquidClip(progress) {
  const cx = canvas.width / 2;
  const cy = canvas.height;
  const maxRadius = Math.hypot(canvas.width, canvas.height) * 1.05;
  const r = maxRadius * ease(progress);

  ctx.save();
  ctx.beginPath();
  // Draw a “liquid flood” arc starting from bottom
  ctx.moveTo(cx, cy);
  ctx.arc(cx, cy, r, Math.PI, 0, false);
  ctx.lineTo(canvas.width, cy);
  ctx.lineTo(0, cy);
  ctx.closePath();
  ctx.clip();
}

function draw(now) {
  if (!startTime) startTime = now;
  const elapsed = now - startTime;

  // Progress for liquid fill (1.15s)
  const progress = Math.min(elapsed / 1150, 1);

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  liquidClip(progress);

  const flowX = Math.sin(t * 0.35);
  const flowY = Math.cos(t * 0.32);
  const breathe = Math.sin(t * 0.45) * 1.1;
  const radius = 70 + breathe;

  const colors = [
    [0, 140, 255],   // blue
    [120, 80, 255],  // purple
    [255, 80, 200],  // pink
    [255, 180, 90],  // gold
    [255, 90, 60]    // orange
  ];

  const grad = ctx.createLinearGradient(
    canvas.width * (0.5 + 0.35 * flowX),
    canvas.height * (0.5 + 0.35 * flowY),
    canvas.width * (0.5 - 0.35 * flowX),
    canvas.height * (0.5 - 0.35 * flowY)
  );
  colors.forEach((c, i) => {
    grad.addColorStop(i / (colors.length - 1), `rgb(${c[0]},${c[1]},${c[2]})`);
  });

  // Glow layers dissolve inward
  const layers = 22;
  for (let i = layers; i > 0; i--) {
    const p = i / layers;
    ctx.strokeStyle = grad;
    ctx.globalAlpha = Math.pow(p, 2.1) * 0.5;
    ctx.lineWidth = p * 20;

    roundedRect(
      (layers - i) * 1.4,
      (layers - i) * 1.4,
      canvas.width - (layers - i) * 2.8,
      canvas.height - (layers - i) * 2.8,
      radius - (layers - i) * 1.0
    );
    ctx.stroke();
  }

  ctx.restore();
  ctx.globalAlpha = 1;

  // Start glow animation after liquid fill
  if (progress >= 1) t += 0.02;

  requestAnimationFrame(draw);
}

async function start() {
  if (started) return;
  started = true;

  try { await navigator.mediaDevices.getUserMedia({ audio: true }); } catch {}

  // Play sound at 0.95s
  setTimeout(() => {
    sound.play().catch(() => {});
  }, 300);

  requestAnimationFrame(draw);
}

// Trigger on first tap to satisfy autoplay rules (PWAs/Apps ignore this)
document.addEventListener("pointerdown", start, { once: true });
</script>
</body>
</html>
